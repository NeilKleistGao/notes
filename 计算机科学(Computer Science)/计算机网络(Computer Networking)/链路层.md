# 数据链路层
+ 结点：运行链路层协议的任何设备
+ 链路：沿着通信路径连接相邻结点的通信信道

在通过特定的链路时，传输结点将数据报封装在链路层帧中，并将该帧传送到链路中。

完成的功能：
+ 向网络层提供一个定义良好的接口
+ 处理传输错误
+ 调节数据流，确保接收方不会被淹没

拆分比特流的方法：
+ 字节计数法：使用帧头部的一个字段来标识该帧中的字符数
+ 字节填充的标志比特法：使用特定的字节来标识帧的开始和结束，当标识和帧中内容相同时，需要使用转义字符进行转义
+ 比特填充的标志比特法：以HDLC（高级数据链路控制协议）为例，0b01111110被用作标志字节，在中间的数据中，每当遇到连续的5个1,则自动在后面追加一个0
+ 物理层编码违禁法：对于4B5B线性编码，使用空闲的编码控制帧的开始和结束。

链路层主体在网络适配器中实现。

## 差错检测和纠正技术
奇偶校验：为数据添加一个比特。偶校验中需要保证所有数据的异或结果为0，奇校验相反。

二位奇偶校验包括行校验和列校验，并且可以找到出错位置。

接收方检测和纠正差错的能力被称为前向纠错（Forward Error Correction，FEC）。

## 海明码
数据块总长为n，其中包含m位数据和r位校验位（即`n = m + r`），记为(n, m)码。

两个码字中不同位的个数称为海明距离。如果两个码字的海明距离为d，则需要d个错误才能将一个码字转变为另一个码字。如果需要检测d个错误，那么码字最后海明距离至少为d+1（即保证其不会变为另一个码字）；如果需要纠正d个错误，那么码字至少需要2d+1的海明距离（即d个错误发生时可以找到离它最近的合法码字）。

在只考虑一个位置出错的情况下，对于`2^m`个合法消息，任何一个消息都会有n个非法码字，使得这个非法码字和合法码字间的海明距离为1。因此每个合法消息需要使用`n+1`个位模式来识别（包括不出错的情况）。由于总共只有`2^n`个位模式，所以我们要求`(n + 1)2^m <= 2^n`，即`(m + r + 1) <= 2^r`。

海明码校验步骤：
+ 选取第1,2,4,8,...,2^k为校验位，其余位置为数据位
+ 对于第1位，其需要校验所有剩下的奇数位置上的值，或者说，二进制第0位为1位置上的值；其余校验位类推
+ 满足奇偶校验中的一种，补充校验位。

## 里德所罗门码
用于二维码纠错。TODO。

## CRC循环校验
CRC编码也被称为多项式编码。所有的CRC计算采取模2运算（异或）。

对于一个给定的数据段D，发送方需要选择r个附加比特，使得用模2算术运算时这d+r个比特刚好可以被G除尽。

因为`D*2^r XOR R = nG`，所以`D*2^r = nG XOR R`，即`R = D*2^r % G`。每个CRC标准都可以检测小于r+1比特的差错。

对于比特串G，也可以写作多项式的形式，如0x10011等价于`x^4 + x + 1`。对于一个r阶的多项式，我们也选择r位的纠错码。

## 链路层协议
### PPP（点到点协议）
串行线路Internet协议（SLIP）的改进。

主要特性：
+ 一种成帧方法：毫无歧义地区分出一帧的结束和下一帧的开始
+ 一个链路控制协议：启动线路，测试线路，协商参数，关闭线路，该协议被称为链路控制协议（LCP）
+ 一种协商网络层的办法：对于每一种不同的网络层，都有一个不同的网络控制协议(NCP)

![](pictures/1-6.png)

+ 地址字段始终是上值，表示所有站点都接受该帧
+ Control字段默认值00000011，表示无编号帧
+ 协议字段中以0开始的编码定义为IPv4等网络层协议，以1开始的编码定义PPP自身的配置协议

### HDLC（高级数据链路控制）
早期被广泛使用的家庭协议实例。

与PPP的区别：
+ PPP是面向字节的，HDLC是面向比特的，且允许帧的长度不是字节的倍数
+ HDLC是可靠传输，提供了滑动窗口，确认和超时机制

# 介质控制访问子层
